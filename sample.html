<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ตัวอย่างข้อสอบ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Itim&display=swap" rel="stylesheet">
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>
    <script type="text/javascript" id="MathJax-script" async
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
        </script>
    <style>
        body {
            font-family: 'Itim', sans-serif;
            overflow: hidden;
        }

        .answer-option.correct {
            background-color: #23b81e !important;
            color: white !important;
            border-color: #059669 !important;
        }

        #quiz-container {
            height: 100vh;
            width: 100vw;
            max-width: 100vw;
            border-radius: 0;
            box-shadow: none;
            padding: 1rem 2rem;
            display: flex;
            flex-direction: column;
        }

        #main-content {
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 0;
            gap: 2rem;
        }

        #image-container img {
            max-height: 90%;
            object-fit: contain;
            width: 100%;
        }

        #qa-container {
            display: flex;
            height: 100%;
        }

        #image-container {
            display: none;
        }

        #qa-container {
            width: 100%;
        }

        .format-1 #qa-container {
            flex-direction: column;
        }

        .format-1 #question-wrapper {
            flex-basis: 40%;
        }

        .format-1 #answer-options {
            flex-basis: 60%;
        }

        #question-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        #answer-options {
            display: grid;
            align-content: center;
            gap: 1.5rem;
        }

        #question-text {
            font-size: clamp(4.25rem, 8vh, 6.5rem);
            line-height: 1.3;
            padding: 1rem;
            font-weight: 700;
        }

        .answer-option {
            font-size: clamp(3.25rem, 5vh, 5rem);
            padding: clamp(1rem, 2vh, 2rem);
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.3;
        }

        #question-text svg {
            display: inline;
        }
    </style>
</head>

<body class="bg-gray-100 flex items-center justify-center min-h-screen p-0">

    <div id="quiz-container" class="bg-white p-6 md:p-8 w-full">
        <div class="flex-shrink-0">
            <div class="flex justify-end items-center mb-4 gap-4">
                <div class="flex items-center gap-4 md:gap-6">
                    <div id="timer" class="text-3xl md:text-4xl font-bold"></div>
                    <div id="question-counter" class="text-lg md:text-xl font-semibold text-gray-600">ตัวอย่าง</div>
                </div>
            </div>
        </div>

        <div id="main-content" class="flex">
            <div id="image-container"><img id="question-image" src="" alt="รูปประกอบคำถาม" class="rounded-lg"></div>
            <div id="qa-container">
                <div id="question-wrapper">
                    <p id="question-text" class="text-gray-800"></p>
                </div>
                <div id="answer-options" class="grid grid-cols-1 md:grid-cols-2"></div>
            </div>
        </div>

        <div class="flex-shrink-0">
            <div class="flex flex-col md:flex-row items-center justify-between mt-8 pt-6 border-t border-gray-200">
                <div class="flex gap-4 mb-4 md:mb-0">
                    <button id="show-answer-btn"
                        class="w-full md:w-auto bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg transition-colors duration-300 text-lg">
                        เฉลย
                    </button>
                    <button id="play-sound-btn"
                        class="w-full md:w-auto bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg transition-colors duration-300 text-lg">
                        เล่นเสียง
                    </button>
                </div>
                <button id="back-btn"
                    class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-3 px-6 rounded-lg transition-colors duration-300 text-lg">
                    กลับไปหน้าแรก
                </button>
            </div>
        </div>
    </div>

    <script>
        const sampleQuestion = {
            questionFormat: 1,
            question: "คำตอบของสมการ $x^2 - 5x + 6 = 0$ คือข้อใด",
            answerOptions: [
                { text: "$x=1, x=6$", isCorrect: false },
                { text: "$x=2, x=3$", isCorrect: true },
                { text: "$x=-2, x=-3$", isCorrect: false },
                { text: "$x=-1, x=-6$", isCorrect: false }
            ]
        };

        const mainContent = document.getElementById('main-content');
        const questionTextEl = document.getElementById('question-text');
        const answerOptionsEl = document.getElementById('answer-options');
        const showAnswerBtn = document.getElementById('show-answer-btn');
        const backBtn = document.getElementById('back-btn');
        const playSoundBtn = document.getElementById('play-sound-btn');
        const timerEl = document.getElementById('timer');
        const imageContainer = document.getElementById('image-container');
        const questionImage = document.getElementById('question-image');

        let timerInterval;
        const TIME_LIMIT = 30;
        let audioCtx;

        function playTimeoutSound() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                if (!audioCtx) {
                    console.error("Web Audio API is not supported in this browser.");
                    return;
                }
            }
            let alarmInterval;
            let note = 0;
            const frequencies = [880, 660];
            const playBeep = () => {
                const oscillator = audioCtx.createOscillator();
                const gainNode = audioCtx.createGain();
                oscillator.type = 'square';
                oscillator.frequency.setValueAtTime(frequencies[note % 2], audioCtx.currentTime);
                gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime + 0.15);
                oscillator.connect(gainNode);
                gainNode.connect(audioCtx.destination);
                oscillator.start(audioCtx.currentTime);
                oscillator.stop(audioCtx.currentTime + 0.15);
                note++;
            };
            alarmInterval = setInterval(playBeep, 200);
            setTimeout(() => {
                clearInterval(alarmInterval);
            }, 3000);
        }

        function startTimer() {
            clearInterval(timerInterval);
            let timeLeft = TIME_LIMIT;
            timerEl.textContent = timeLeft;
            timerEl.classList.remove('text-red-500');
            timerEl.classList.add('text-green-600');
            timerInterval = setInterval(() => {
                timeLeft--;
                timerEl.textContent = timeLeft;
                if (timeLeft <= 10) {
                    timerEl.classList.remove('text-green-600');
                    timerEl.classList.add('text-red-500');
                }
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    playTimeoutSound();
                    Array.from(answerOptionsEl.children).forEach(btn => {
                        btn.disabled = true;
                        btn.classList.add('opacity-80');
                    });
                }
            }, 1000);
        }

        function displayQuestion() {
            showAnswerBtn.disabled = false;
            startTimer();
            questionTextEl.innerHTML = sampleQuestion.question;
            mainContent.className = `flex flex-grow min-h-0 format-${sampleQuestion.questionFormat}`;
            if (sampleQuestion.imageUrl) {
                imageContainer.classList.remove('hidden');
                questionImage.src = sampleQuestion.imageUrl;
            } else {
                imageContainer.classList.add('hidden');
            }
            const prefixes = ['ก.', 'ข.', 'ค.', 'ง.'];
            sampleQuestion.answerOptions.forEach((option, index) => {
                const optionEl = document.createElement('button');
                optionEl.innerHTML = `${prefixes[index]} ${option.text}`;
                optionEl.classList.add('answer-option', 'w-full', 'p-4', 'border-2', 'border-gray-300', 'rounded-lg', 'hover:bg-gray-100', 'hover:border-blue-400');
                answerOptionsEl.appendChild(optionEl);
            });
            if (window.MathJax) {
                MathJax.typesetPromise([questionTextEl, answerOptionsEl]);
            }
        }

        function showAnswer() {
            clearInterval(timerInterval);
            const options = answerOptionsEl.children;
            for (let i = 0; i < options.length; i++) {
                if (sampleQuestion.answerOptions[i].isCorrect) {
                    options[i].classList.add('correct');
                }
                options[i].disabled = true;
            }
            showAnswerBtn.disabled = true;
        }

        showAnswerBtn.addEventListener('click', showAnswer);
        playSoundBtn.addEventListener('click', playTimeoutSound);
        backBtn.addEventListener('click', () => {
            window.location.href = 'intro.html';
        });

        window.onload = displayQuestion;
    </script>
</body>

</html>